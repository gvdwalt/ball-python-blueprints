blueprint:
  name: Ball Python Lighting Schedule
  description: >
    Controls UVB light and WLED presets based on sunrise, sunset, and fixed time.
    - Turns UVB ON + WLED to Morning preset 1 hour after sunrise
    - Turns UVB OFF + WLED to Night preset 30 min after sunset
    - Turns all WLED OFF at 22:00
    - Optionally toggles day_mode input_boolean
  domain: automation
  input:
    uvb_light:
      name: UVB Light Entity
      selector:
        entity:
          domain: light

    wled_light:
      name: WLED Light Entity
      selector:
        entity:
          domain: light

    wled_preset_select:
      name: WLED Preset Selector (select entity)
      selector:
        entity:
          domain: select

    morning_preset:
      name: Morning Preset Name
      selector:
        text:

    night_preset:
      name: Night Preset Name
      selector:
        text:

    day_mode_boolean:
      name: (Optional) Day Mode Boolean
      default: ""
      selector:
        entity:
          domain: input_boolean

trigger:
  - platform: sun
    event: sunrise
    offset: "01:00:00"
    id: sunrise_plus_1h

  - platform: sun
    event: sunset
    offset: "00:30:00"
    id: sunset_plus_30m

  - platform: time
    at: "22:00:00"
    id: night_shutdown

variables:
  day_mode_entity: !input day_mode_boolean

action:
  - choose:

      # ðŸŒ… 1 hour after sunrise
      - conditions:
          - condition: trigger
            id: sunrise_plus_1h
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input uvb_light
          - service: select.select_option
            target:
              entity_id: !input wled_preset_select
            data:
              option: !input morning_preset
          - service: light.turn_on
            target:
              entity_id: !input wled_light
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ day_mode_entity != '' }}"
                sequence:
                  - service: input_boolean.turn_on
                    target:
                      entity_id: "{{ day_mode_entity }}"

      # ðŸŒ‡ 30 min after sunset
      - conditions:
          - condition: trigger
            id: sunset_plus_30m
        sequence:
          - service: light.turn_off
            target:
              entity_id: !input uvb_light
          - service: select.select_option
            target:
              entity_id: !input wled_preset_select
            data:
              option: !input night_preset
          - service: light.turn_on
            target:
              entity_id: !input wled_light
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ day_mode_entity != '' }}"
                sequence:
                  - service: input_boolean.turn_off
                    target:
                      entity_id: "{{ day_mode_entity }}"

      # ðŸŒŒ Full lights off at 22:00
      - conditions:
          - condition: trigger
            id: night_shutdown
        sequence:
          - service: light.turn_off
            target:
              entity_id: !input wled_light
